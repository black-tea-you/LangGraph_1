# V4-Batch ì•„í‚¤í…ì²˜ ì „í™˜ ë¶„ì„

## ğŸ“‹ ëª©ì°¨
1. [í˜„ì¬ êµ¬ì¡° vs V4-Batch ë¹„êµ](#1-í˜„ì¬-êµ¬ì¡°-vs-v4-batch-ë¹„êµ)
2. [ì‹¤ì œ ì²˜ë¦¬ ì‹œê°„ ê³„ì‚°](#2-ì‹¤ì œ-ì²˜ë¦¬-ì‹œê°„-ê³„ì‚°)
3. [30ì´ˆ ëª©í‘œ ë‹¬ì„± ê°€ëŠ¥ì„± ë¶„ì„](#3-30ì´ˆ-ëª©í‘œ-ë‹¬ì„±-ê°€ëŠ¥ì„±-ë¶„ì„)
4. [êµ¬í˜„ ë³µì¡ë„ í‰ê°€](#4-êµ¬í˜„-ë³µì¡ë„-í‰ê°€)
5. [ì¥ë‹¨ì  ì¢…í•© ë¶„ì„](#5-ì¥ë‹¨ì -ì¢…í•©-ë¶„ì„)
6. [ê¶Œì¥ì‚¬í•­](#6-ê¶Œì¥ì‚¬í•­)

---

## 1. í˜„ì¬ êµ¬ì¡° vs V4-Batch ë¹„êµ

### ğŸ”„ **í˜„ì¬ êµ¬ì¡° (V4-Background)**

```
ì±„íŒ… í”Œë¡œìš°:
1. Intent Analyzer (1-2ì´ˆ)
2. Writer LLM (2-3ì´ˆ)
3. ì‘ë‹µ ë°˜í™˜ (ì¦‰ì‹œ)
   â†“ (ë°±ê·¸ë¼ìš´ë“œ)
4. Eval Turn SubGraph (5-10ì´ˆ) - ë¹„ë™ê¸°

ì œì¶œ í”Œë¡œìš°:
1. Eval Turn Guard (ìµœëŒ€ 60ì´ˆ ëŒ€ê¸°)
   - ë°±ê·¸ë¼ìš´ë“œ í‰ê°€ ì™„ë£Œ í™•ì¸
   - ëˆ„ë½ í„´ ì¬í‰ê°€
2. í‰ê°€ ë…¸ë“œë“¤ (6a-6d)
3. ìµœì¢… ì ìˆ˜ ì‚°ì¶œ
```

**íŠ¹ì§•:**
- âœ… ì±„íŒ… ì†ë„: ë¹ ë¦„ (3-5ì´ˆ)
- âš ï¸ ì œì¶œ ì†ë„: ëŠë¦¼ (60ì´ˆ+ ëŒ€ê¸° í¬í•¨)
- âš ï¸ ë°±ê·¸ë¼ìš´ë“œ í‰ê°€ ì™„ë£Œ ë³´ì¥ ì–´ë ¤ì›€

### ğŸ†• **V4-Batch êµ¬ì¡°**

```
ì±„íŒ… í”Œë¡œìš°:
1. Intent Analyzer (1-2ì´ˆ)
2. Writer LLM (2-3ì´ˆ)
3. DB ì €ì¥ (ì¦‰ì‹œ)
4. ì‘ë‹µ ë°˜í™˜ (ì¦‰ì‹œ)
   â†“ (í‰ê°€ ì—†ìŒ!)

ì œì¶œ í”Œë¡œìš°:
1. Batch Eval Turns (30ê°œ í„´ ë³‘ë ¬ í‰ê°€)
   - Semaphore(5)ë¡œ ë™ì‹œ ì‹¤í–‰ ì œí•œ
   - asyncio.gather()ë¡œ ë³‘ë ¬ ì²˜ë¦¬
2. Eval Holistic Flow (Chaining ë¶„ì„)
3. Code Performance/Correctness
4. ìµœì¢… ì ìˆ˜ ì‚°ì¶œ
```

**íŠ¹ì§•:**
- âœ… ì±„íŒ… ì†ë„: ë§¤ìš° ë¹ ë¦„ (3-5ì´ˆ, í‰ê°€ ì—†ìŒ)
- â“ ì œì¶œ ì†ë„: 30ì´ˆ ëª©í‘œ (ì‹¤ì œë¡œëŠ”?)
- âœ… í‰ê°€ ì™„ë£Œ ë³´ì¥: ì œì¶œ ì‹œì ì— ëª¨ë“  í‰ê°€ ì‹¤í–‰

---

## 2. ì‹¤ì œ ì²˜ë¦¬ ì‹œê°„ ê³„ì‚°

### ğŸ“Š **ë‹¨ì¼ í„´ í‰ê°€ ì†Œìš” ì‹œê°„ ë¶„ì„**

#### **í˜„ì¬ êµ¬ì¡°ì—ì„œ ì¸¡ì •ëœ ì‹œê°„:**

```python
# app/langgraph/nodes/turn_evaluator/analysis.py
# - Intent ë¶„ì„: 1-2ì´ˆ (LLM í˜¸ì¶œ 1íšŒ)

# app/langgraph/nodes/turn_evaluator/evaluators.py
# - ê° í‰ê°€ í•¨ìˆ˜: 1-3ì´ˆ (LLM í˜¸ì¶œ 1íšŒ)
# - 7ê°œ ì˜ë„ ì¤‘ 1-2ê°œ ì„ íƒ â†’ 1-3ì´ˆ

# app/langgraph/nodes/turn_evaluator/summary.py
# - ë‹µë³€ ìš”ì•½: 1-2ì´ˆ (LLM í˜¸ì¶œ 1íšŒ)

# ì´ ì†Œìš” ì‹œê°„: 3-7ì´ˆ (í‰ê·  5ì´ˆ)
```

#### **LLM API ì‘ë‹µ ì‹œê°„:**
- Gemini API: í‰ê·  2-3ì´ˆ/ìš”ì²­
- ë„¤íŠ¸ì›Œí¬ ì§€ì—°: 0.5-1ì´ˆ
- **ì´í•©: 2.5-4ì´ˆ/ìš”ì²­**

#### **ë‹¨ì¼ í„´ í‰ê°€ LLM í˜¸ì¶œ íšŸìˆ˜:**
```
1. Intent ë¶„ì„: 1íšŒ
2. ì˜ë„ë³„ í‰ê°€: 1-2íšŒ (í‰ê·  1.5íšŒ)
3. ë‹µë³€ ìš”ì•½: 1íšŒ

ì´: 3.5íšŒ (í‰ê· )
ì†Œìš” ì‹œê°„: 3.5 * 3ì´ˆ = 10.5ì´ˆ (ìµœì•…)
          3.5 * 2ì´ˆ = 7ì´ˆ (ìµœì„ )
          3.5 * 2.5ì´ˆ = 8.75ì´ˆ (í‰ê· )
```

**ì‹¤ì œ ì¸¡ì •ê°’ (í˜„ì¬ êµ¬ì¡°):**
- ìµœì†Œ: 5ì´ˆ
- í‰ê· : 8ì´ˆ
- ìµœëŒ€: 12ì´ˆ (ë„¤íŠ¸ì›Œí¬ ì§€ì—° í¬í•¨)

---

### â±ï¸ **V4-Batch ì²˜ë¦¬ ì‹œê°„ ê³„ì‚°**

#### **ì‹œë‚˜ë¦¬ì˜¤: 30ê°œ í„´ í‰ê°€**

**ê°€ì •:**
- Semaphore í¬ê¸°: 5 (ë™ì‹œ ì‹¤í–‰ ì œí•œ)
- ë‹¨ì¼ í„´ í‰ê°€ ì‹œê°„: 8ì´ˆ (í‰ê· )
- LLM API Rate Limit: 15 RPM (Gemini ë¬´ë£Œ í‹°ì–´)

**ê³„ì‚°:**

```
1. ë°°ì¹˜ ìˆ˜ ê³„ì‚°:
   30ê°œ í„´ Ã· 5 (Semaphore) = 6 ë°°ì¹˜

2. ê° ë°°ì¹˜ ì²˜ë¦¬ ì‹œê°„:
   - ë°°ì¹˜ 1: í„´ 1-5 ë™ì‹œ ì‹¤í–‰ â†’ 8ì´ˆ
   - ë°°ì¹˜ 2: í„´ 6-10 ë™ì‹œ ì‹¤í–‰ â†’ 8ì´ˆ
   - ë°°ì¹˜ 3: í„´ 11-15 ë™ì‹œ ì‹¤í–‰ â†’ 8ì´ˆ
   - ë°°ì¹˜ 4: í„´ 16-20 ë™ì‹œ ì‹¤í–‰ â†’ 8ì´ˆ
   - ë°°ì¹˜ 5: í„´ 21-25 ë™ì‹œ ì‹¤í–‰ â†’ 8ì´ˆ
   - ë°°ì¹˜ 6: í„´ 26-30 ë™ì‹œ ì‹¤í–‰ â†’ 8ì´ˆ

3. ì´ ì²˜ë¦¬ ì‹œê°„:
   6 ë°°ì¹˜ Ã— 8ì´ˆ = 48ì´ˆ
```

**âš ï¸ ë¬¸ì œì :**
- 30ì´ˆ ëª©í‘œë¥¼ **18ì´ˆ ì´ˆê³¼** (48ì´ˆ)
- Rate Limit ìœ„ë°˜ ê°€ëŠ¥ì„± (30ê°œ í„´ Ã— 3.5íšŒ = 105íšŒ í˜¸ì¶œ)

---

### ğŸ”§ **30ì´ˆ ë‹¬ì„±ì„ ìœ„í•œ ìµœì í™”**

#### **ë°©ì•ˆ 1: Semaphore í¬ê¸° ì¦ê°€**

```
Semaphore = 10ìœ¼ë¡œ ì¦ê°€:
30ê°œ í„´ Ã· 10 = 3 ë°°ì¹˜
3 ë°°ì¹˜ Ã— 8ì´ˆ = 24ì´ˆ âœ… (30ì´ˆ ëª©í‘œ ë‹¬ì„±!)
```

**ë‹¨ì :**
- Rate Limit ìœ„ë°˜ ìœ„í—˜ ì¦ê°€ (10ê°œ ë™ì‹œ ì‹¤í–‰)
- Gemini ë¬´ë£Œ í‹°ì–´: 15 RPM â†’ 10ê°œ ë™ì‹œ ì‹¤í–‰ ì‹œ ì´ˆê³¼ ê°€ëŠ¥

#### **ë°©ì•ˆ 2: LLM ì‘ë‹µ ì‹œê°„ ë‹¨ì¶•**

```
í˜„ì¬: 8ì´ˆ/í„´
ëª©í‘œ: 5ì´ˆ/í„´ (ìµœì í™”)

Semaphore = 5:
6 ë°°ì¹˜ Ã— 5ì´ˆ = 30ì´ˆ âœ… (ì •í™•íˆ ëª©í‘œ ë‹¬ì„±!)

Semaphore = 10:
3 ë°°ì¹˜ Ã— 5ì´ˆ = 15ì´ˆ âœ… (ì—¬ìœ  ìˆìŒ)
```

**ìµœì í™” ë°©ë²•:**
- í”„ë¡¬í”„íŠ¸ ìµœì í™” (í† í° ìˆ˜ ê°ì†Œ)
- ëª¨ë¸ ë³€ê²½ (gemini-2.5-flash â†’ ë” ë¹ ë¥¸ ëª¨ë¸)
- ìºì‹± í™œìš© (ìœ ì‚¬ í”„ë¡¬í”„íŠ¸ ì¬ì‚¬ìš©)

#### **ë°©ì•ˆ 3: í•˜ì´ë¸Œë¦¬ë“œ ì ‘ê·¼**

```
ì±„íŒ… ì¤‘: ë°±ê·¸ë¼ìš´ë“œ í‰ê°€ ìœ ì§€ (í˜„ì¬ ë°©ì‹)
ì œì¶œ ì‹œ: ëˆ„ë½ í„´ë§Œ Batch í‰ê°€

ì¥ì :
- ì±„íŒ… ì†ë„ ìœ ì§€
- ì œì¶œ ì‹œ ëŒ€ê¸° ì‹œê°„ ìµœì†Œí™”
- Rate Limit ë¶„ì‚°
```

---

## 3. 30ì´ˆ ëª©í‘œ ë‹¬ì„± ê°€ëŠ¥ì„± ë¶„ì„

### âœ… **ë‹¬ì„± ê°€ëŠ¥ ì‹œë‚˜ë¦¬ì˜¤**

#### **ì‹œë‚˜ë¦¬ì˜¤ A: ìµœì  ì¡°ê±´**
```
- Semaphore: 10
- ë‹¨ì¼ í„´ í‰ê°€: 5ì´ˆ
- Rate Limit: ì¶©ë¶„ (ìœ ë£Œ í‹°ì–´ ë˜ëŠ” ë¶„ì‚°)
- ë„¤íŠ¸ì›Œí¬: ì•ˆì •ì 

ì²˜ë¦¬ ì‹œê°„: 3 ë°°ì¹˜ Ã— 5ì´ˆ = 15ì´ˆ âœ…
```

#### **ì‹œë‚˜ë¦¬ì˜¤ B: í˜„ì‹¤ì  ì¡°ê±´**
```
- Semaphore: 5
- ë‹¨ì¼ í„´ í‰ê°€: 6ì´ˆ (ìµœì í™” í›„)
- Rate Limit: 15 RPM (ë¬´ë£Œ í‹°ì–´)
- ë„¤íŠ¸ì›Œí¬: ë³´í†µ

ì²˜ë¦¬ ì‹œê°„: 6 ë°°ì¹˜ Ã— 6ì´ˆ = 36ì´ˆ âš ï¸ (6ì´ˆ ì´ˆê³¼)
```

#### **ì‹œë‚˜ë¦¬ì˜¤ C: ìµœì•… ì¡°ê±´**
```
- Semaphore: 5
- ë‹¨ì¼ í„´ í‰ê°€: 8ì´ˆ (í˜„ì¬)
- Rate Limit: 15 RPM
- ë„¤íŠ¸ì›Œí¬: ë¶ˆì•ˆì •

ì²˜ë¦¬ ì‹œê°„: 6 ë°°ì¹˜ Ã— 8ì´ˆ = 48ì´ˆ âŒ (18ì´ˆ ì´ˆê³¼)
```

### ğŸ“Š **ë‹¬ì„± ê°€ëŠ¥ì„± í‰ê°€**

| ì¡°ê±´ | Semaphore | í„´ í‰ê°€ ì‹œê°„ | ì´ ì‹œê°„ | ë‹¬ì„± ì—¬ë¶€ |
|------|-----------|-------------|---------|----------|
| ìµœì  | 10 | 5ì´ˆ | 15ì´ˆ | âœ… |
| í˜„ì‹¤ì  | 5 | 6ì´ˆ | 36ì´ˆ | âš ï¸ |
| ìµœì•… | 5 | 8ì´ˆ | 48ì´ˆ | âŒ |

**ê²°ë¡ :**
- **ìµœì  ì¡°ê±´ì—ì„œë§Œ 30ì´ˆ ë‹¬ì„± ê°€ëŠ¥**
- **í˜„ì‹¤ì ìœ¼ë¡œëŠ” 35-40ì´ˆ ì˜ˆìƒ**
- **ìµœì•…ì˜ ê²½ìš° 50ì´ˆ+ ì†Œìš”**

---

## 4. êµ¬í˜„ ë³µì¡ë„ í‰ê°€

### ğŸ”´ **ë†’ì€ ë³µì¡ë„ í•­ëª©**

#### **1. Batch Eval Turns ë…¸ë“œ êµ¬í˜„**

```python
# ë³µì¡ë„: ë†’ìŒ
async def batch_eval_turns_node(state: dict):
    # 1. messagesì—ì„œ í„´ ìŒ ì¶”ì¶œ (ë³µì¡í•œ íŒŒì‹± ë¡œì§)
    turn_pairs = extract_turn_pairs(state["messages"])
    
    # 2. Semaphore ì„¤ì • ë° ë™ì‹œ ì‹¤í–‰ ì œí•œ
    sem = asyncio.Semaphore(5)
    
    # 3. ê° í„´ í‰ê°€ í•¨ìˆ˜ í˜¸ì¶œ (ê¸°ì¡´ ë¡œì§ ì¬ì‚¬ìš©)
    async def protected_eval(turn_data):
        async with sem:
            return await evaluate_single_turn_logic(turn_data)
    
    # 4. ë³‘ë ¬ ì‹¤í–‰ ë° ê²°ê³¼ ìˆ˜ì§‘
    tasks = [protected_eval(pair) for pair in turn_pairs]
    turn_logs = await asyncio.gather(*tasks)
    
    # 5. ì—ëŸ¬ ì²˜ë¦¬ (ì¼ë¶€ ì‹¤íŒ¨ ì‹œ ì¬ì‹œë„)
    # 6. Rate Limit ì²˜ë¦¬ (429 ì—ëŸ¬ ëŒ€ì‘)
```

**ì˜ˆìƒ ê°œë°œ ì‹œê°„:**
- ê¸°ë³¸ êµ¬í˜„: 4-6ì‹œê°„
- ì—ëŸ¬ ì²˜ë¦¬: 2-3ì‹œê°„
- í…ŒìŠ¤íŠ¸: 2-3ì‹œê°„
- **ì´: 8-12ì‹œê°„**

#### **2. í„´ ìŒ ì¶”ì¶œ ë¡œì§**

```python
# ë³µì¡ë„: ì¤‘ê°„
def extract_turn_pairs(messages: list) -> list:
    """
    messages ë°°ì—´ì—ì„œ User-AI ìŒì„ ì¶”ì¶œ
    
    ë¬¸ì œì :
    - LangChain ê°ì²´ vs dict í˜¼ì¬
    - turn ì •ë³´ê°€ ì—†ì„ ìˆ˜ ìˆìŒ
    - ë©”ì‹œì§€ ìˆœì„œ ë¶ˆì¼ì¹˜ ê°€ëŠ¥ì„±
    """
    turn_pairs = []
    i = 0
    while i < len(messages) - 1:
        # User ë©”ì‹œì§€ ì°¾ê¸°
        if is_user_message(messages[i]):
            # AI ë©”ì‹œì§€ ì°¾ê¸°
            if is_ai_message(messages[i+1]):
                turn_pairs.append({
                    "turn_index": i // 2 + 1,
                    "human_msg": extract_content(messages[i]),
                    "ai_msg": extract_content(messages[i+1])
                })
                i += 2
            else:
                i += 1
        else:
            i += 1
    return turn_pairs
```

**ì˜ˆìƒ ê°œë°œ ì‹œê°„:**
- ê¸°ë³¸ ë¡œì§: 2-3ì‹œê°„
- ì—£ì§€ ì¼€ì´ìŠ¤ ì²˜ë¦¬: 1-2ì‹œê°„
- **ì´: 3-5ì‹œê°„**

#### **3. Rate Limit ì²˜ë¦¬**

```python
# ë³µì¡ë„: ë†’ìŒ
async def protected_eval_with_retry(turn_data):
    async with sem:
        max_retries = 3
        for attempt in range(max_retries):
            try:
                return await evaluate_single_turn_logic(turn_data)
            except RateLimitError:
                if attempt < max_retries - 1:
                    wait_time = (2 ** attempt) * 4  # Exponential backoff
                    await asyncio.sleep(wait_time)
                else:
                    raise
```

**ì˜ˆìƒ ê°œë°œ ì‹œê°„:**
- ê¸°ë³¸ ì¬ì‹œë„ ë¡œì§: 2-3ì‹œê°„
- Exponential backoff: 1-2ì‹œê°„
- í…ŒìŠ¤íŠ¸: 1-2ì‹œê°„
- **ì´: 4-7ì‹œê°„**

### ğŸ“Š **ì´ êµ¬í˜„ ì‹œê°„ ì˜ˆìƒ**

| í•­ëª© | ì˜ˆìƒ ì‹œê°„ |
|------|----------|
| Batch Eval Turns ë…¸ë“œ | 8-12ì‹œê°„ |
| í„´ ìŒ ì¶”ì¶œ ë¡œì§ | 3-5ì‹œê°„ |
| Rate Limit ì²˜ë¦¬ | 4-7ì‹œê°„ |
| í†µí•© í…ŒìŠ¤íŠ¸ | 4-6ì‹œê°„ |
| **ì´ê³„** | **19-30ì‹œê°„** |

**2ì£¼ í”„ë¡œí† íƒ€ì… ê¸°ì¤€:**
- ì£¼ë‹¹ 40ì‹œê°„ ì‘ì—… ê°€ì •
- **1ì£¼ì¼ ë‚´ êµ¬í˜„ ê°€ëŠ¥** (ì—¬ìœ  ìˆìŒ)

---

## 5. ì¥ë‹¨ì  ì¢…í•© ë¶„ì„

### âœ… **ì¥ì **

#### **1. ì±„íŒ… ì†ë„ ìµœì í™”**
```
í˜„ì¬: 3-5ì´ˆ (ë°±ê·¸ë¼ìš´ë“œ í‰ê°€ í¬í•¨)
V4-Batch: 2-3ì´ˆ (í‰ê°€ ì—†ìŒ)

ê°œì„ : 1-2ì´ˆ ë‹¨ì¶• (20-40% í–¥ìƒ)
```

#### **2. í‰ê°€ ì™„ë£Œ ë³´ì¥**
```
í˜„ì¬: ë°±ê·¸ë¼ìš´ë“œ í‰ê°€ ì™„ë£Œ ë¶ˆí™•ì‹¤
V4-Batch: ì œì¶œ ì‹œì ì— ëª¨ë“  í‰ê°€ ì‹¤í–‰

ì¥ì : ë°ì´í„° ì •í•©ì„± ë³´ì¥
```

#### **3. êµ¬ì¡°ì  ëª…í™•ì„±**
```
í˜„ì¬: ì±„íŒ…ê³¼ í‰ê°€ê°€ í˜¼ì¬
V4-Batch: ì±„íŒ…ê³¼ í‰ê°€ ì™„ì „ ë¶„ë¦¬

ì¥ì : ì½”ë“œ ìœ ì§€ë³´ìˆ˜ì„± í–¥ìƒ
```

### âŒ **ë‹¨ì **

#### **1. ì œì¶œ ì†ë„ ì €í•˜**
```
í˜„ì¬: 60ì´ˆ+ (ëŒ€ê¸° í¬í•¨)
V4-Batch: 35-50ì´ˆ (ì‹¤ì œ í‰ê°€)

ë¬¸ì œ: 30ì´ˆ ëª©í‘œ ë‹¬ì„± ì–´ë ¤ì›€
```

#### **2. Rate Limit ìœ„ë°˜ ìœ„í—˜**
```
30ê°œ í„´ Ã— 3.5íšŒ LLM í˜¸ì¶œ = 105íšŒ
Gemini ë¬´ë£Œ í‹°ì–´: 15 RPM

ë¬¸ì œ: 105íšŒ í˜¸ì¶œì€ 7ë¶„ ì´ìƒ ì†Œìš”
```

#### **3. êµ¬í˜„ ë³µì¡ë„ ì¦ê°€**
```
í˜„ì¬: ë°±ê·¸ë¼ìš´ë“œ í‰ê°€ (ë‹¨ìˆœ)
V4-Batch: Batch ì²˜ë¦¬ + Rate Limit + ì—ëŸ¬ ì²˜ë¦¬

ë¬¸ì œ: ê°œë°œ ì‹œê°„ 19-30ì‹œê°„ ì†Œìš”
```

#### **4. ì‚¬ìš©ì ê²½í—˜ ì €í•˜**
```
í˜„ì¬: ì±„íŒ… ì¤‘ í‰ê°€ (ì‚¬ìš©ì ëª¨ë¥´ê²Œ)
V4-Batch: ì œì¶œ ì‹œ ëŒ€ê¸° (ì‚¬ìš©ì ì²´ê°)

ë¬¸ì œ: ì œì¶œ ë²„íŠ¼ í´ë¦­ í›„ 30-50ì´ˆ ëŒ€ê¸°
```

---

## 6. ê¶Œì¥ì‚¬í•­

### ğŸ¯ **í•˜ì´ë¸Œë¦¬ë“œ ì ‘ê·¼ (ì¶”ì²œ)**

í˜„ì¬ êµ¬ì¡°ë¥¼ ìœ ì§€í•˜ë˜, V4-Batchì˜ ì¥ì ë§Œ ì„ íƒì ìœ¼ë¡œ ë„ì…:

#### **Phase 1: í˜„ì¬ êµ¬ì¡° ê°œì„  (1ì£¼)**
```
1. Eval Turn Guard ëŒ€ê¸° ì‹œê°„ ìµœì í™”
   - í˜„ì¬: 60ì´ˆ â†’ ëª©í‘œ: 30ì´ˆ
   - ë°±ê·¸ë¼ìš´ë“œ í‰ê°€ ì†ë„ í–¥ìƒ

2. Rate Limit ì²˜ë¦¬ ê°•í™”
   - Exponential backoff
   - ìš”ì²­ ê°„ê²© ì¡°ì ˆ

3. ì±„íŒ… ì¤‘ DB ì €ì¥ ì¶”ê°€
   - í‰ê°€ ì™„ë£Œ ì‹œ PostgreSQL ì €ì¥
   - ë°ì´í„° ì •í•©ì„± ë³´ì¥
```

#### **Phase 2: ì„ íƒì  Batch í‰ê°€ (1ì£¼)**
```
1. ì œì¶œ ì‹œ ëˆ„ë½ í„´ë§Œ Batch í‰ê°€
   - ë°±ê·¸ë¼ìš´ë“œ ì™„ë£Œëœ í„´ì€ ì¬í‰ê°€ ì•ˆ í•¨
   - ëˆ„ë½ í„´ë§Œ Semaphoreë¡œ ë³‘ë ¬ ì²˜ë¦¬

2. Holistic Flow í‰ê°€ ìµœì í™”
   - ê¸°ì¡´ turn_logs í™œìš©
   - ì¤‘ë³µ í‰ê°€ ë°©ì§€
```

### ğŸ“Š **ë¹„êµí‘œ**

| í•­ëª© | í˜„ì¬ êµ¬ì¡° | V4-Batch | í•˜ì´ë¸Œë¦¬ë“œ |
|------|----------|----------|-----------|
| **ì±„íŒ… ì†ë„** | 3-5ì´ˆ | 2-3ì´ˆ | 3-5ì´ˆ |
| **ì œì¶œ ì†ë„** | 60ì´ˆ+ | 35-50ì´ˆ | 40-50ì´ˆ |
| **í‰ê°€ ì™„ë£Œ ë³´ì¥** | âš ï¸ ë¶ˆí™•ì‹¤ | âœ… ë³´ì¥ | âœ… ë³´ì¥ |
| **êµ¬í˜„ ë³µì¡ë„** | ë‚®ìŒ | ë†’ìŒ | ì¤‘ê°„ |
| **Rate Limit ìœ„í—˜** | ë‚®ìŒ | ë†’ìŒ | ì¤‘ê°„ |
| **ê°œë°œ ì‹œê°„** | - | 19-30ì‹œê°„ | 10-15ì‹œê°„ |

### âœ… **ìµœì¢… ê¶Œì¥ì‚¬í•­**

**V4-Batch ì™„ì „ ì „í™˜ì€ ê¶Œì¥í•˜ì§€ ì•ŠìŒ**

**ì´ìœ :**
1. 30ì´ˆ ëª©í‘œ ë‹¬ì„± ì–´ë ¤ì›€ (í˜„ì‹¤ì ìœ¼ë¡œ 35-50ì´ˆ)
2. Rate Limit ìœ„ë°˜ ìœ„í—˜ ë†’ìŒ
3. êµ¬í˜„ ë³µì¡ë„ ëŒ€ë¹„ ì´ë“ ì ìŒ
4. ì‚¬ìš©ì ê²½í—˜ ì €í•˜ (ì œì¶œ ëŒ€ê¸° ì‹œê°„)

**ëŒ€ì‹  í•˜ì´ë¸Œë¦¬ë“œ ì ‘ê·¼ ê¶Œì¥:**
1. í˜„ì¬ êµ¬ì¡° ìœ ì§€ (ì±„íŒ… ì†ë„ ë³´ì¥)
2. Eval Turn Guard ê°œì„  (ëŒ€ê¸° ì‹œê°„ ìµœì í™”)
3. ì„ íƒì  Batch í‰ê°€ (ëˆ„ë½ í„´ë§Œ)
4. Rate Limit ì²˜ë¦¬ ê°•í™”

**ì˜ˆìƒ ê²°ê³¼:**
- ì±„íŒ… ì†ë„: ìœ ì§€ (3-5ì´ˆ)
- ì œì¶œ ì†ë„: ê°œì„  (40-50ì´ˆ, í˜„ì¬ 60ì´ˆ+ ëŒ€ë¹„)
- í‰ê°€ ì™„ë£Œ ë³´ì¥: ê°œì„  (âœ…)
- ê°œë°œ ì‹œê°„: ì ˆì•½ (10-15ì‹œê°„ vs 19-30ì‹œê°„)

---

**ì‘ì„±ì¼**: 2024-01-01  
**ë²„ì „**: 1.0  
**ë¶„ì„ ê¸°ì¤€**: Gemini API ë¬´ë£Œ í‹°ì–´, 30ê°œ í„´ í‰ê°€

